{% extends "base.html" %}

{% block title %}Professor Dashboard - College Notes Portal{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        margin-bottom: 40px;
    }

    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 800;
        letter-spacing: -0.025em;
        margin-bottom: 8px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 24px;
        margin-bottom: 48px;
    }

    .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 32px;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary);
    }

    .stat-card i {
        font-size: 32px;
        color: var(--primary);
        background: rgba(var(--primary-rgb), 0.1);
        width: 64px;
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px;
    }

    .stat-card h3 {
        font-size: 2.25rem;
        font-weight: 800;
        color: var(--text-main);
    }

    .stat-card p {
        color: var(--text-muted);
        font-weight: 500;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 32px;
        box-shadow: var(--shadow-sm);
        margin-bottom: 32px;
    }

    .note-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: var(--bg-body);
        border-radius: var(--radius-md);
        border: 1px solid transparent;
        transition: var(--transition);
        gap: 16px;
    }

    .note-item:hover {
        border-color: var(--primary);
        background: var(--bg-card);
        box-shadow: var(--shadow-md);
    }

    .note-info h4 {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .note-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .note-meta i {
        color: var(--primary);
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header"
    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; gap: 20px; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 200px;">
        <h1 class="dashboard-title" style="margin: 0;">Professor Dashboard</h1>
        <p class="text-muted" style="margin: 4px 0 0 0;">Welcome back, {{ username }}!</p>
    </div>
    <div class="header-actions" style="display: flex; gap: 12px; flex-wrap: wrap;">
        <a href="{{ url_for('upload_note') }}" class="btn btn-primary btn-pill">
            <i class="fas fa-upload"></i> <span class="desktop-only">Upload Note</span>
        </a>
        <a href="{{ url_for('create_meeting') }}" class="btn btn-outline btn-pill">
            <i class="fas fa-video"></i> <span class="desktop-only">Schedule Meeting</span>
        </a>
        <a href="{{ url_for('list_students') }}" class="btn btn-outline btn-pill">
            <i class="fas fa-users"></i> <span class="desktop-only">My Students</span>
        </a>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <i class="fas fa-file-upload"></i>
        <h3>{{ total_notes }}</h3>
        <p>Notes Uploaded</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-chalkboard-teacher"></i>
        <h3>Professor</h3>
        <p>Your Role</p>
    </div>
    <div class="stat-card">
        <i class="fas fa-clock"></i>
        <h3>24/7</h3>
        <p>Access Available</p>
    </div>
</div>

<div class="card">
    <h2 class="section-title">
        <i class="fas fa-video"></i> Your Upcoming Meetings
    </h2>
    {% if upcoming_meetings %}
    <div class="grid-responsive">
        {% for meeting in upcoming_meetings %}
        <div class="note-item" style="flex-direction: column; align-items: flex-start;">
            <div class="note-info">
                <h4 style="color: var(--primary);">{{ meeting.title }}</h4>
                <div class="note-meta" style="flex-direction: column; gap: 4px;">
                    <span><i class="fas fa-book"></i> {{ meeting.subject or 'General' }}</span>
                    <span><i class="fas fa-clock"></i> {{ meeting.start_time.strftime('%b %d, %Y at %H:%M') if
                        meeting.start_time else 'No Time' }}</span>
                    <span><i class="fas fa-user-circle"></i> {{ 'Hosted by you' if meeting.host_id == current_user.id
                        else 'Co-hosted' }}</span>
                </div>
            </div>
            <a href="{{ meeting.meeting_link }}" target="_blank" class="btn btn-primary btn-sm"
                style="margin-top: 12px; width: 100%; justify-content: center;">
                Start Session
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-video-slash"></i>
        <p>No meetings scheduled. Start one now!</p>
        <a href="{{ url_for('create_meeting') }}" class="btn btn-primary btn-sm" style="margin-top:10px;">Schedule
            Meeting</a>
    </div>
    {% endif %}
</div>

<div class="card">
    <h2 class="section-title">
        <i class="fas fa-chart-line"></i> Recent Progress Reports
    </h2>
    {% if recent_reports %}
    <div class="grid-responsive">
        {% for report in recent_reports %}
        <div class="note-item">
            <div class="note-info">
                <h4 style="color: var(--primary);">{{ report.title }}</h4>
                <div class="note-meta" style="flex-direction: column; gap: 4px;">
                    <span><i class="fas fa-user-graduate"></i> {{ report.student.username }}</span>
                    <span><i class="fas fa-book-open"></i> {{ report.semester or 'N/A' }}</span>
                    <span><i class="fas fa-clock"></i> {{ report.created_at.strftime('%b %d, %Y') if report.created_at
                        else 'No Date' }}</span>
                </div>
            </div>
            <div style="margin-top: 12px; width: 100%; display: flex; gap: 8px;">
                {% if report.filename %}
                <a href="{{ url_for('view_progress_file', report_id=report.id) }}" target="_blank"
                    class="btn btn-primary btn-sm" style="flex: 1; justify-content: center;">
                    View
                </a>
                {% endif %}
                <a href="{{ url_for('list_progress', student_id=report.student_id) }}" class="btn btn-outline btn-sm"
                    style="flex: 1; justify-content: center;">
                    History
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-chart-bar"></i>
        <p>No progress reports uploaded recently.</p>
        <a href="{{ url_for('upload_progress') }}" class="btn btn-primary btn-sm" style="margin-top:10px;">Upload
            Report</a>
    </div>
    {% endif %}
</div>

<div class="card">
    <h2 class="section-title">
        <i class="fas fa-history"></i> Your Recent Uploads
    </h2>
    {% if my_notes %}
    <div class="notes-list">
        {% for note in my_notes %}
        <div class="note-item">
            <div class="note-info">
                <h4>{{ note.title }}</h4>
                <div class="note-meta">
                    <span><i class="fas fa-book"></i> {{ note.subject or 'General' }}</span>
                    <span><i class="fas fa-calendar"></i> {{ note.semester or 'N/A' }}</span>
                    <span><i class="fas fa-clock"></i> {{ note.upload_time.strftime('%b %d, %Y at %H:%M') if
                        note.upload_time else 'No Date' }}</span>
                    {% if note.file_size %}
                    <span><i class="fas fa-file"></i> {{ note.file_size|filesize }}</span>
                    {% endif %}
                </div>
            </div>
            <div class="note-actions">
                <a href="{{ url_for('download_note', note_id=note.id) }}" class="btn btn-primary btn-sm">
                    <i class="fas fa-download"></i>
                </a>
                <form action="{{ url_for('delete_note', note_id=note.id) }}" method="POST" style="display: inline;"
                    onsubmit="return confirm('Are you sure you want to delete this note?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-cloud-upload-alt"></i>
        <p>You haven't uploaded any notes yet.</p>
        <a href="{{ url_for('upload_note') }}" class="btn btn-primary" style="margin-top: 15px;">
            <i class="fas fa-upload"></i> Upload Your First Note
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}